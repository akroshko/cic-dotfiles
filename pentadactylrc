" {{{ Modifed by akroshko }}}
" {{{ beslayed's pentadactyl configuration with Emacs bindings,  based on anrxc's vimperator configuration with Emacs bindings, but with fairly major changes to the bindings
" {{{ this has not been used for quite some time and may not be useful yet!!! }}}
"
" Bindings
"
" source: * http://babbagefiles.blogspot.com
" (based on: * http://sysphere.org/~anrxc/j/articles/vimperator/index.html)
"
" Todo (anrcx's)
"  * C-n and C-p in "INSERT (menu)" mode
"    * http://code.google.com/p/vimperator-labs/issues/detail?id=36

" License (both)
"  * http://creativecommons.org/publicdomain/zero/1.0
" }}}

" {{{ Options
"

" Turn off auto-autocompletion (press tab to see autocompletions)
set autocomplete=

" determine which tabs open with focus
set activate=addons,bookmarks,diverted,extoptions,help,homepage,quickmark

" XXX defualt for now
" pentadactyl gui options
" set go=rbC

" Editor, C-e invokes it in text fields
set editor="emacsclient -c"

" TODO change this?
" Show destination links in 1=status line, 2=command line
" set showstatuslinks=2

" hint size
highlight Hint font-size:18px;color:white;background-color:red;padding:2px;
" hint letters
set hintkeys=abcdefghijklmnopqrstuvwxyz

" {{{ Key bindings
"     - Emacs GTK key-theme and FF already provide bindings for input fields
"

" C-v was pass-next, remap to bind with default keys
map <C-d> <C-v>

" M-x enters command mode
nmap <A-x> :

" Emacs navigation in command line and insert mode
cmap <A-n> <Tab>
cmap <A-p> <S-Tab>
cmap <C-f> <Right>
cmap <C-n> <Down>
cmap <C-p> <Up>
cmap <C-b> <Left>
cmap <C-j> <CR>
nmap <C-j> <CR>
imap <C-j> <CR>
imap <C-n> <Down>
imap <C-p> <Up>
imap <C-f> <Right>
imap <C-b> <Left>

" backspace goes pageup
nnoremap <BS> <C-d>

" use g for open
nmap g :open<Space>
nmap G T<CR>

" Also F and B (like Conkeror)
nmap F :forward<CR>
nmap B :back<CR>

" Use M-f and M-b for buffer/tab browsing
" TODO: should I map this in conkeror? make it like my Emacs
nmap <A-f> :tabnext<CR>
nmap <A-b> :tabprevious<CR>

" Use C-f and C-b to re-order tabs
" TODO: do I want this?
map <C-Left> :tabmove! -1<CR>
map <C-Right> :tabmove! +1<CR>

" Select all ("mark entire buffer or field")
nmap <C-x>h <C-z><C-a><Esc>
imap <C-x>h <C-z><C-a><Esc>
vmap <C-x>h <C-z><C-a><Esc>

" Use C-a and C-e to go to the absolute left/right of the document
nmap <C-a> 0
nmap <C-e> $

" Use C-p and C-n for up/down
nmap <C-p> 2k
nmap <C-n> 2j

" Use C-v and M-v for jump scrolling
nmap <C-v> <C-d>
nmap <A-v> <C-u>

" Goto the top of the document with M-<
nmap <A-<> gg

" Goto the end of the document with M->
nmap <A->> G

" Use C-s and C-r for searching (n/N for next/prev as in less)
nmap <C-s> /
nmap <C-r> ?

" Use M-s and M-r for finding word under cursor
" TODO: should I remap this in emacs?
nmap <A-s> *
nmap <A-r> #

" Copy selected text to the clipboard with C-w
nmap <C-w> Y
imap <C-w> <C-d><C-c><Esc>
tmap <C-w> <C-d><C-c><Esc>
nmap <A-w> Y
imap <A-w> <C-d><C-c><Esc>
tmap <A-w> <C-d><C-c><Esc>

" Copy the current URL to the clipboard with c-0
nmap c0 y

" Yank (i.e. paste) the current clipboard selection with C-y
imap <C-y> <S-Ins>
tmap <C-y> i_<S-Ins>
nmap <C-y> <S-Ins>
cmap <C-y> <S-Ins>
vmap <C-y> <S-Ins>

" TODO consider how to take advantage of these?
" Yank (i.e. paste) the current clipboard selection to new background buffer with M-y
nmap <A-y> P
" Yank (i.e. paste) the current clipboard selection to a new focussed buffer with C-M-y
nmap <C-A-y> :tabopen!<SPACE><S-Ins><CR>

" C-g as cancel (C-q is stop) (except QuickHint mode, see below)
cmap <C-g> <Esc>
imap <C-g> <Esc>
nmap <C-g> <Esc>
vmap <C-g> <Esc>

" Avoid Find dialog when cancelling a started command, C-x C-g
" [note QuickHint mode can only be cancelled by <Esc>]
nmap <C-x><C-g> <Esc>

" Avoid quit on C-q, and it's more suitable for Stop here
nmap <C-q> :stop<CR>

" Exit and save the contents of all buffers (=save session) with C-x s
nmap <C-x>s :xall<CR>

" Exit without saving the session with C-x C-c
nmap <C-x><C-c> :quitall<CR>

" Select another buffer with C-x b
nmap <C-x>b :buffer<SPACE>

" List all buffers with C-x C-b
nmap <C-x><C-b> :buffers<CR>

" Close the current tab ("kill buffer") with C-x k
" Close the current tab ("delete this window") with C-x 0
nmap <C-x>k :tabclose<CR>
nmap <C-x>0 :tabclose<CR>

" Close currently selected window ("delete this frame") with C-x 5 0
nmap <C-x>50 :winclose<CR>

" Undo close tab with C-_ (also with C-Shift-t, as C-t is new tab)
" (Also with C-x u, C-/)
nmap <C-_> :undo<CR>
nmap <C-x>u :undo<CR>
nmap <C-/> :undo<CR>

" Close all other tabs ("delete all other windows") with C-x 1
nmap <C-x>1 :tabonly<CR>

" Close all other windows ("delete all other frames") with C-x 5 1
nmap <C-x>51 :winonly<CR>

" Switch to previously selected tab ("switch cursor to other window") with C-x o
nmap <C-x>o <C-6>

" TODO how to do these in conkeror?
" Duplicate tab ("split window") with C-x 2
nmap <C-x>2 T<CR>

" Duplicate window ("split frame") with C-x 5 2
nmap <C-x>52 W<CR>

" Open a URL in the current buffer with C-x C-f
nmap <C-x><C-f> :open<SPACE>

" TODO use the 0 key?
" Open a URL based on current location in the current buffer with C-x C-v
" ("replace the contents of this buffer with new URL")
nmap <C-x><C-v> O

" Open a URL in a new window with C-x 5 f
nmap <C-x>5f :winopen<SPACE>

" These are definitely things I want!!!
" Open a URL in a new background tab with C-x t
nmap <C-x>t :tabopen<SPACE>

" Open a URL based on current location in new background tab with C-x T
nmap <C-x>T T

" Open a URL in a new focussed tab with C-x C-t
"                                  with C-x 4 f
nmap <C-x><C-t> :tabopen!<SPACE>
nmap <C-x>4f :tabopen!<SPACE>

" TODO use extended mode hint!

" Use C-h r to start pentadactyl help
" Use C-h i to go to pentadactyl index
" Use C-h t to go to pentadactyl quickstart tutorial
" Use C-h I to go to emacslik pentadactyl quickreference card
nmap <C-h>r :help<CR>
nmap <C-h>i o<SPACE>dactyl://help/index<CR>
nmap <C-h>t o<SPACE>dactyl://help/tutorial<CR>
nmap <C-h>I o<SPACE>http://www.jnanam.net/pentadactylemacs/pentadactylemacs.html<CR>

" Record a key sequence into a macro with C-x (
nmap <C-x>( q

" Play a macro with C-x e
nmap <C-x>e @

" Set a jump-mark at the cursor with C-x r m
nmap <C-x>rm m

" Jump to the jump-mark in the current buffer with C-x r b
nmap <C-x>rb '

" List all jump-marks with C-x r l
nmap <C-x>rl :marks<CR>

" C-x C-w starts the "Save as" dialog
map <C-x><C-w> <C-d><C-s>

" M-Up/Dn toggles the toolbar and scrollbars
" map <A-Down> :set go+=BTm<CR>
" map <A-Up> :set go-=BTm<CR>

" Focus last used input field with C-c i
" TODO do I want this?
map <C-c>i gi

" Add a bookmark with C-c a (dialog)
" TODO disable bookmarks?
map <C-c>a <C-d><C-d>

" Bookmarks search, and search by tag
" TODO disable bookmarks?
map <C-c>q :bmarks<SPACE>
map <C-c>w :bmarks -tags=

" Dialog selection with d
" NO!!! this is good but I want it for other things
map d :dialog<SPACE>

" View source with C-c g, and
" TODO is this the one I want?
map <C-c>g gf

" ... in an editor with C-c e
" TODO is this the one I want?
map <C-c>e gF

" Open picture location with C-c p
" TODO is this the one I want?
map <C-c>p ;i

" Open context menu with C-c m
" TODO is the the one I want?
map <C-c>m ;c

" Open home directory with C-c f
" TODO is the the one I want?
map <C-c>f ~

" Go to home page with C-c h
" TODO is the the one I want?
nmap <C-c>h gh

" Go to parent directory with C-c u
" TODO is the the one I want?
map <C-c>u gu

" Go to the root of the website with C-c C-u
" TODO is the the one I want?
map <C-c><C-u> gU

" Restart with C-c C-r
" TODO is the the one I want?
map <C-c><C-r> :restart<CR>


" Turn off certain keybindings
" TODO some of these I want to use!!!
:map D <Nop>
:map u <Nop>
:map w <Nop>
:map W <Nop>
:map <C-u> <Nop>


" {{{ Wikipedia look-up macro
"
:command -nargs=* wiki tabopen wikipedia <args>
"
" }}}
" TODO: can this be done without the echo?
" echo "[pentadactyl initialized]"



"-------------------------
"Considered


" Use C-x C-f to start the "Open File" dialog  (currently used for opening new url)

"-----------------------
"NOT USED

" Extended hint mode with M-f
"  ; - focus link, a - save, y - copy link, O - :open query, T - for :tabopen ...
" nmap <A-f> ;


" Use C-a and C-e to jump to first/last tab
"nmap <C-a> g0
"nmap <C-e> g$
"
" Sidebar selection with s, close with S
" map s :sidebar<SPACE>
" map S :sbclose<CR>


" Focus the address bar with C-l
" map <C-l> <C-d><C-l>

" Tab moving helpers
"map <C-m> :tabmove<SPACE>

" }}}

" {{{ Javascript functions
"
" Show the Feed and Bookmark buttons on the statusbar
" THIS IS VERY VALUABLE!!!
javascript <<EOF
(function(){
    var statusPanel = document.createElement("statusbarpanel");
    statusPanel.setAttribute("id", "buttons-panel-clone");
    statusPanel.appendChild(document.getElementById("feed-button"));
    statusPanel.appendChild(document.getElementById("star-button"));
    statusPanel.firstChild.setAttribute("style", "padding: 0; max-height: 16px;");
    document.getElementById("status-bar")
            .insertBefore(statusPanel, document.getElementById("security-button"));
})();
EOF
" }}}

" {{{ Enable gmail-specific keybindings (disabled because this can bypassed with <C-Z>)
"
" autocmd LocationChange .* :js modes.passAllKeys = /mail\.google\.com|www\.google\.com\/reader\/view/.test(buffer.URL)
"
" }}}

" {{{ Plugin bindings
"
" Buftabs
map <C-c>b :set invbuftabs<CR>

" Noscript
map <C-c>s :noscript toggletemp<CR>
map <C-c>S :noscript popup<CR>

" TinyURL
" map <C-c>t :exe ":tinyurl "+getBrowser().contentWindow.location.href<CR>
" }}}
" }}}